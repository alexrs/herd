Loaded module: cuda/11.6
Loaded dependency [python3/3.11.4]: gcc/12.3.0-binutils-2.40
Loaded dependency [python3/3.11.4]: sqlite3/3.42.0
Loaded module: python3/3.11.4

Loading python3/3.11.4
  Loading requirement: gcc/12.3.0-binutils-2.40 sqlite3/3.42.0
Found cached dataset parquet (/work3/s212722/herd/datasets/cache/alexrs___parquet/alexrs--alpaca-cleaned-30-clusters-a73d614e768ecc90/0.0.0/14a00e99c0d15a23649d0db8944380ac81082d4b021f398733dd84f3a6c569a7)
Loading cached processed dataset at /work3/s212722/herd/datasets/cache/alexrs___parquet/alexrs--alpaca-cleaned-30-clusters-a73d614e768ecc90/0.0.0/14a00e99c0d15a23649d0db8944380ac81082d4b021f398733dd84f3a6c569a7/cache-d9616c7f8e09c4b4.arrow
2023-11-01 20:56:02.830 | INFO     | herd.finetune_utils:get_peft_config:30 - Fine-tuning with MoLoRA using 30 experts
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:03<00:03,  3.39s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:04<00:00,  2.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:04<00:00,  2.34s/it]
2023-11-01 20:56:09.200 | WARNING  | herd.finetune:_finetune_experts:183 - Number of experts is not 1 but we are training an expert, setting it to 1. num_experts: 1
/zhome/03/c/164482/code/herd/.venv/lib/python3.11/site-packages/trl/trainer/utils.py:246: UserWarning: The passed formatting_func has more than one argument. Usually that function should have a single argument `example` which corresponds to the dictonnary returned by each element of the dataset. Make sure you know what you are doing.
  warnings.warn(
2023-11-01 20:56:42.809 | INFO     | herd.finetune:_finetune_experts:215 - Training expert: expert_11, output_dir: /work3/s212722/herd/meta-llama/Llama-2-7b-hf/alpaca-30/all_linear_paged_adam_4bit/molora/expert_11
wandb: Currently logged in as: alexrs95. Use `wandb login --relogin` to force relogin
wandb: wandb version 0.15.12 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.15.10
wandb: Run data is saved locally in /zhome/03/c/164482/code/herd/wandb/run-20231101_205644-d79c9lax
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run molora/expert_11
wandb: ⭐️ View project at https://wandb.ai/alexrs95/herd-llama
wandb: 🚀 View run at https://wandb.ai/alexrs95/herd-llama/runs/d79c9lax
  0%|          | 0/1022 [00:00<?, ?it/s]You're using a LlamaTokenizerFast tokenizer. Please note that with a fast tokenizer, using the `__call__` method is faster than using a method to encode the text followed by a call to the `pad` method to get a padded encoding.
`use_cache=True` is incompatible with gradient checkpointing. Setting `use_cache=False`...
  0%|          | 1/1022 [00:07<2:08:37,  7.56s/it]  0%|          | 2/1022 [00:13<1:51:50,  6.58s/it]  0%|          | 3/1022 [00:19<1:46:28,  6.27s/it]  0%|          | 4/1022 [00:25<1:43:55,  6.13s/it]  0%|          | 5/1022 [00:31<1:42:30,  6.05s/it]  1%|          | 6/1022 [00:37<1:41:39,  6.00s/it]  1%|          | 7/1022 [00:43<1:41:07,  5.98s/it]  1%|          | 8/1022 [00:48<1:40:44,  5.96s/it]  1%|          | 9/1022 [00:54<1:40:27,  5.95s/it]  1%|          | 10/1022 [01:00<1:40:14,  5.94s/it]                                                     1%|          | 10/1022 [01:00<1:40:14,  5.94s/it]  1%|          | 11/1022 [01:06<1:40:04,  5.94s/it]  1%|          | 12/1022 [01:12<1:39:57,  5.94s/it]  1%|▏         | 13/1022 [01:18<1:39:50,  5.94s/it]  1%|▏         | 14/1022 [01:24<1:39:44,  5.94s/it]  1%|▏         | 15/1022 [01:30<1:39:37,  5.94s/it]  2%|▏         | 16/1022 [01:36<1:39:32,  5.94s/it]  2%|▏         | 17/1022 [01:42<1:39:29,  5.94s/it]  2%|▏         | 18/1022 [01:48<1:39:23,  5.94s/it]  2%|▏         | 19/1022 [01:54<1:39:18,  5.94s/it]  2%|▏         | 20/1022 [02:00<1:39:12,  5.94s/it]                                                     2%|▏         | 20/1022 [02:00<1:39:12,  5.94s/it]  2%|▏         | 21/1022 [02:06<1:39:08,  5.94s/it]  2%|▏         | 22/1022 [02:12<1:39:03,  5.94s/it]  2%|▏         | 23/1022 [02:18<1:38:57,  5.94s/it]  2%|▏         | 24/1022 [02:23<1:38:51,  5.94s/it]  2%|▏         | 25/1022 [02:29<1:38:46,  5.94s/it]  3%|▎         | 26/1022 [02:35<1:38:41,  5.95s/it]  3%|▎         | 27/1022 [02:42<1:40:50,  6.08s/it]  3%|▎         | 28/1022 [02:48<1:40:19,  6.06s/it]  3%|▎         | 29/1022 [02:54<1:39:41,  6.02s/it]  3%|▎         | 30/1022 [03:00<1:39:12,  6.00s/it]                                                     3%|▎         | 30/1022 [03:00<1:39:12,  6.00s/it]  3%|▎         | 31/1022 [03:06<1:38:49,  5.98s/it]  3%|▎         | 32/1022 [03:12<1:38:33,  5.97s/it]  3%|▎         | 33/1022 [03:17<1:38:18,  5.96s/it]  3%|▎         | 34/1022 [03:23<1:38:07,  5.96s/it]  3%|▎         | 35/1022 [03:29<1:37:58,  5.96s/it]  4%|▎         | 36/1022 [03:35<1:37:48,  5.95s/it]  4%|▎         | 37/1022 [03:41<1:37:42,  5.95s/it]  4%|▎         | 38/1022 [03:47<1:37:34,  5.95s/it]  4%|▍         | 39/1022 [03:53<1:37:28,  5.95s/it]  4%|▍         | 40/1022 [03:59<1:37:22,  5.95s/it]                                                     4%|▍         | 40/1022 [03:59<1:37:22,  5.95s/it]  4%|▍         | 41/1022 [04:05<1:37:16,  5.95s/it]  4%|▍         | 42/1022 [04:11<1:37:11,  5.95s/it]  4%|▍         | 43/1022 [04:17<1:37:05,  5.95s/it]  4%|▍         | 44/1022 [04:23<1:36:58,  5.95s/it]  4%|▍         | 45/1022 [04:29<1:36:53,  5.95s/it]  5%|▍         | 46/1022 [04:35<1:36:48,  5.95s/it]  5%|▍         | 47/1022 [04:41<1:36:41,  5.95s/it]  5%|▍         | 48/1022 [04:47<1:36:36,  5.95s/it]  5%|▍         | 49/1022 [04:53<1:36:29,  5.95s/it]  5%|▍         | 50/1022 [04:59<1:36:22,  5.95s/it]                                                     5%|▍         | 50/1022 [04:59<1:36:22,  5.95s/it]  5%|▍         | 51/1022 [05:05<1:36:15,  5.95s/it]  5%|▌         | 52/1022 [05:10<1:36:09,  5.95s/it]  5%|▌         | 53/1022 [05:16<1:36:04,  5.95s/it]  5%|▌         | 54/1022 [05:22<1:35:58,  5.95s/it]  5%|▌         | 55/1022 [05:28<1:35:51,  5.95s/it]  5%|▌         | 56/1022 [05:34<1:35:46,  5.95s/it]  6%|▌         | 57/1022 [05:40<1:35:40,  5.95s/it]  6%|▌         | 58/1022 [05:46<1:35:34,  5.95s/it]  6%|▌         | 59/1022 [05:52<1:35:28,  5.95s/it]  6%|▌         | 60/1022 [05:58<1:35:22,  5.95s/it]                                                     6%|▌         | 60/1022 [05:58<1:35:22,  5.95s/it]  6%|▌         | 61/1022 [06:04<1:35:16,  5.95s/it]  6%|▌         | 62/1022 [06:10<1:35:11,  5.95s/it]  6%|▌         | 63/1022 [06:16<1:35:06,  5.95s/it]  6%|▋         | 64/1022 [06:22<1:34:59,  5.95s/it]  6%|▋         | 65/1022 [06:28<1:34:53,  5.95s/it]  6%|▋         | 66/1022 [06:34<1:34:47,  5.95s/it]  7%|▋         | 67/1022 [06:40<1:34:40,  5.95s/it]  7%|▋         | 68/1022 [06:46<1:34:33,  5.95s/it]  7%|▋         | 69/1022 [06:52<1:34:27,  5.95s/it]  7%|▋         | 70/1022 [06:58<1:34:21,  5.95s/it]                                                     7%|▋         | 70/1022 [06:58<1:34:21,  5.95s/it]  7%|▋         | 71/1022 [07:04<1:34:16,  5.95s/it]  7%|▋         | 72/1022 [07:09<1:34:11,  5.95s/it]  7%|▋         | 73/1022 [07:15<1:34:05,  5.95s/it]  7%|▋         | 74/1022 [07:21<1:33:58,  5.95s/it]  7%|▋         | 75/1022 [07:27<1:33:52,  5.95s/it]  7%|▋         | 76/1022 [07:33<1:33:47,  5.95s/it]  8%|▊         | 77/1022 [07:39<1:33:42,  5.95s/it]  8%|▊         | 78/1022 [07:45<1:33:35,  5.95s/it]  8%|▊         | 79/1022 [07:51<1:33:30,  5.95s/it]  8%|▊         | 80/1022 [07:57<1:33:23,  5.95s/it]                                                     8%|▊         | 80/1022 [07:57<1:33:23,  5.95s/it]  8%|▊         | 81/1022 [08:03<1:33:17,  5.95s/it]  8%|▊         | 82/1022 [08:08<1:27:03,  5.56s/it]  8%|▊         | 83/1022 [08:15<1:33:48,  5.99s/it]  8%|▊         | 84/1022 [08:21<1:33:28,  5.98s/it]  8%|▊         | 85/1022 [08:27<1:33:13,  5.97s/it]  8%|▊         | 86/1022 [08:33<1:33:02,  5.96s/it]  9%|▊         | 87/1022 [08:38<1:32:57,  5.96s/it]  9%|▊         | 88/1022 [08:44<1:32:46,  5.96s/it]  9%|▊         | 89/1022 [08:50<1:32:36,  5.96s/it]  9%|▉         | 90/1022 [08:56<1:32:28,  5.95s/it]                                                     9%|▉         | 90/1022 [08:56<1:32:28,  5.95s/it]  9%|▉         | 91/1022 [09:02<1:32:22,  5.95s/it]  9%|▉         | 92/1022 [09:08<1:32:15,  5.95s/it]  9%|▉         | 93/1022 [09:14<1:32:08,  5.95s/it]  9%|▉         | 94/1022 [09:20<1:32:02,  5.95s/it]  9%|▉         | 95/1022 [09:26<1:31:57,  5.95s/it]  9%|▉         | 96/1022 [09:32<1:31:51,  5.95s/it]  9%|▉         | 97/1022 [09:38<1:31:43,  5.95s/it] 10%|▉         | 98/1022 [09:44<1:31:36,  5.95s/it] 10%|▉         | 99/1022 [09:50<1:31:30,  5.95s/it] 10%|▉         | 100/1022 [09:56<1:31:25,  5.95s/it]                                                     10%|▉         | 100/1022 [09:56<1:31:25,  5.95s/it] 10%|▉         | 101/1022 [10:02<1:31:19,  5.95s/it] 10%|▉         | 102/1022 [10:08<1:31:14,  5.95s/it] 10%|█         | 103/1022 [10:14<1:31:07,  5.95s/it] 10%|█         | 104/1022 [10:20<1:31:01,  5.95s/it] 10%|█         | 105/1022 [10:26<1:30:56,  5.95s/it] 10%|█         | 106/1022 [10:32<1:30:50,  5.95s/it] 10%|█         | 107/1022 [10:37<1:30:43,  5.95s/it] 11%|█         | 108/1022 [10:43<1:30:37,  5.95s/it] 11%|█         | 109/1022 [10:49<1:30:31,  5.95s/it] 11%|█         | 110/1022 [10:55<1:30:25,  5.95s/it]                                                     11%|█         | 110/1022 [10:55<1:30:25,  5.95s/it] 11%|█         | 111/1022 [11:01<1:30:20,  5.95s/it] 11%|█         | 112/1022 [11:07<1:30:14,  5.95s/it] 11%|█         | 113/1022 [11:13<1:30:09,  5.95s/it] 11%|█         | 114/1022 [11:19<1:30:03,  5.95s/it] 11%|█▏        | 115/1022 [11:25<1:29:57,  5.95s/it] 11%|█▏        | 116/1022 [11:31<1:29:49,  5.95s/it] 11%|█▏        | 117/1022 [11:37<1:29:44,  5.95s/it] 12%|█▏        | 118/1022 [11:43<1:29:39,  5.95s/it] 12%|█▏        | 119/1022 [11:49<1:29:33,  5.95s/it] 12%|█▏        | 120/1022 [11:55<1:29:27,  5.95s/it]                                                     12%|█▏        | 120/1022 [11:55<1:29:27,  5.95s/it] 12%|█▏        | 121/1022 [12:01<1:29:21,  5.95s/it] 12%|█▏        | 122/1022 [12:07<1:29:16,  5.95s/it] 12%|█▏        | 123/1022 [12:13<1:29:11,  5.95s/it] 12%|█▏        | 124/1022 [12:19<1:29:03,  5.95s/it] 12%|█▏        | 125/1022 [12:25<1:28:56,  5.95s/it] 12%|█▏        | 126/1022 [12:31<1:28:49,  5.95s/it] 12%|█▏        | 127/1022 [12:36<1:28:45,  5.95s/it] 13%|█▎        | 128/1022 [12:42<1:28:37,  5.95s/it] 13%|█▎        | 129/1022 [12:48<1:28:32,  5.95s/it] 13%|█▎        | 130/1022 [12:54<1:28:27,  5.95s/it]                                                     13%|█▎        | 130/1022 [12:54<1:28:27,  5.95s/it] 13%|█▎        | 131/1022 [13:00<1:28:22,  5.95s/it] 13%|█▎        | 132/1022 [13:06<1:28:16,  5.95s/it] 13%|█▎        | 133/1022 [13:12<1:28:10,  5.95s/it] 13%|█▎        | 134/1022 [13:18<1:28:04,  5.95s/it] 13%|█▎        | 135/1022 [13:24<1:27:57,  5.95s/it] 13%|█▎        | 136/1022 [13:30<1:27:52,  5.95s/it] 13%|█▎        | 137/1022 [13:36<1:27:46,  5.95s/it] 14%|█▎        | 138/1022 [13:42<1:27:40,  5.95s/it] 14%|█▎        | 139/1022 [13:48<1:27:33,  5.95s/it] 14%|█▎        | 140/1022 [13:54<1:27:27,  5.95s/it]                                                     14%|█▎        | 140/1022 [13:54<1:27:27,  5.95s/it] 14%|█▍        | 141/1022 [14:00<1:27:22,  5.95s/it] 14%|█▍        | 142/1022 [14:06<1:27:17,  5.95s/it] 14%|█▍        | 143/1022 [14:12<1:27:11,  5.95s/it] 14%|█▍        | 144/1022 [14:18<1:27:03,  5.95s/it] 14%|█▍        | 145/1022 [14:24<1:26:58,  5.95s/it] 14%|█▍        | 146/1022 [14:30<1:26:52,  5.95s/it] 14%|█▍        | 147/1022 [14:35<1:26:45,  5.95s/it] 14%|█▍        | 148/1022 [14:41<1:26:40,  5.95s/it] 15%|█▍        | 149/1022 [14:47<1:26:34,  5.95s/it] 15%|█▍        | 150/1022 [14:53<1:26:28,  5.95s/it]                                                     15%|█▍        | 150/1022 [14:53<1:26:28,  5.95s/it] 15%|█▍        | 151/1022 [14:59<1:26:23,  5.95s/it] 15%|█▍        | 152/1022 [15:05<1:26:17,  5.95s/it] 15%|█▍        | 153/1022 [15:11<1:26:11,  5.95s/it] 15%|█▌        | 154/1022 [15:17<1:26:05,  5.95s/it] 15%|█▌        | 155/1022 [15:23<1:25:59,  5.95s/it] 15%|█▌        | 156/1022 [15:29<1:25:53,  5.95s/it] 15%|█▌        | 157/1022 [15:35<1:25:45,  5.95s/it] 15%|█▌        | 158/1022 [15:41<1:25:41,  5.95s/it] 16%|█▌        | 159/1022 [15:47<1:25:35,  5.95s/it] 16%|█▌        | 160/1022 [15:53<1:25:28,  5.95s/it]                                                     16%|█▌        | 160/1022 [15:53<1:25:28,  5.95s/it] 16%|█▌        | 161/1022 [15:59<1:25:23,  5.95s/it] 16%|█▌        | 162/1022 [16:05<1:25:17,  5.95s/it] 16%|█▌        | 163/1022 [16:11<1:25:11,  5.95s/it] 16%|█▌        | 164/1022 [16:15<1:19:28,  5.56s/it]                                                     16%|█▌        | 164/1022 [16:16<1:19:28,  5.56s/it] 16%|█▌        | 164/1022 [16:16<1:25:07,  5.95s/it]
wandb: Waiting for W&B process to finish... (success).
wandb: 
wandb: Run history:
wandb:                    train/epoch ▁▁▁▁▁▂▂▂▇▇▇▇█████
wandb:              train/global_step ▁▁▂▂▃▃▄▄▅▅▆▆▆▇▇██
wandb:            train/learning_rate ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁
wandb:                     train/loss ████████▃▁▁▁▂▂▂▂
wandb:               train/total_flos ▁
wandb:               train/train_loss ▁
wandb:            train/train_runtime ▁
wandb: train/train_samples_per_second ▁
wandb:   train/train_steps_per_second ▁
wandb: 
wandb: Run summary:
wandb:                    train/epoch 1.16
wandb:              train/global_step 164
wandb:            train/learning_rate 0.0003
wandb:                     train/loss 0.6177
wandb:               train/total_flos 5.326872624208282e+16
wandb:               train/train_loss 0.77141
wandb:            train/train_runtime 978.6897
wandb: train/train_samples_per_second 4.179
wandb:   train/train_steps_per_second 1.044
wandb: 
wandb: 🚀 View run molora/expert_11 at: https://wandb.ai/alexrs95/herd-llama/runs/d79c9lax
wandb: ️⚡ View job at https://wandb.ai/alexrs95/herd-llama/jobs/QXJ0aWZhY3RDb2xsZWN0aW9uOjk5NjEyNzE2/version_details/v15
wandb: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)
wandb: Find logs at: ./wandb/run-20231101_205644-d79c9lax/logs
