Loaded module: cuda/11.6
Loaded dependency [python3/3.11.4]: gcc/12.3.0-binutils-2.40
Loaded dependency [python3/3.11.4]: sqlite3/3.42.0
Loaded module: python3/3.11.4

Loading python3/3.11.4
  Loading requirement: gcc/12.3.0-binutils-2.40 sqlite3/3.42.0
Found cached dataset parquet (/work3/s212722/herd/datasets/cache/alexrs___parquet/alexrs--alpaca-cleaned-15-clusters-dc700effb75224a8/0.0.0/14a00e99c0d15a23649d0db8944380ac81082d4b021f398733dd84f3a6c569a7)
Filter:   0%|          | 0/51760 [00:00<?, ? examples/s]Filter:  14%|█▎        | 7000/51760 [00:00<00:00, 58460.81 examples/s]Filter:  27%|██▋       | 14000/51760 [00:00<00:00, 58671.37 examples/s]Filter:  41%|████      | 21000/51760 [00:00<00:00, 59354.41 examples/s]Filter:  52%|█████▏    | 27000/51760 [00:00<00:00, 59116.03 examples/s]Filter:  68%|██████▊   | 35000/51760 [00:00<00:00, 60326.79 examples/s]Filter:  81%|████████  | 42000/51760 [00:00<00:00, 59917.06 examples/s]Filter:  97%|█████████▋| 50000/51760 [00:00<00:00, 60955.43 examples/s]                                                                       2023-10-28 17:22:53.997 | INFO     | herd.finetune_utils:get_peft_config:30 - Fine-tuning with MoLoRA using 15 experts
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [01:11<01:11, 71.07s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:12<00:00, 29.97s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:12<00:00, 36.14s/it]
2023-10-28 17:24:24.590 | WARNING  | herd.finetune:_finetune_experts:174 - Number of experts is not 1 but we are training an expert, setting it to 1. num_experts: 1
/zhome/03/c/164482/code/herd/.venv/lib/python3.11/site-packages/trl/trainer/utils.py:246: UserWarning: The passed formatting_func has more than one argument. Usually that function should have a single argument `example` which corresponds to the dictonnary returned by each element of the dataset. Make sure you know what you are doing.
  warnings.warn(
2023-10-28 17:24:58.361 | INFO     | herd.finetune:_finetune_experts:206 - Training expert: expert_5, output_dir: /work3/s212722/herd/meta-llama/Llama-2-7b-hf/alpaca-15/all_linear_paged_adam_no_quant/molora/expert_5
wandb: Currently logged in as: alexrs95. Use `wandb login --relogin` to force relogin
wandb: wandb version 0.15.12 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.15.10
wandb: Run data is saved locally in /zhome/03/c/164482/code/herd/wandb/run-20231028_172500-fddzmdwm
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run molora/expert_5
wandb: ⭐️ View project at https://wandb.ai/alexrs95/herd-llama
wandb: 🚀 View run at https://wandb.ai/alexrs95/herd-llama/runs/fddzmdwm
  0%|          | 0/1282 [00:00<?, ?it/s]You're using a LlamaTokenizerFast tokenizer. Please note that with a fast tokenizer, using the `__call__` method is faster than using a method to encode the text followed by a call to the `pad` method to get a padded encoding.
`use_cache=True` is incompatible with gradient checkpointing. Setting `use_cache=False`...
  0%|          | 1/1282 [00:12<4:37:03, 12.98s/it]  0%|          | 2/1282 [00:24<4:13:02, 11.86s/it]  0%|          | 3/1282 [00:35<4:05:30, 11.52s/it]  0%|          | 4/1282 [00:46<4:02:01, 11.36s/it]  0%|          | 5/1282 [00:57<4:00:15, 11.29s/it]  0%|          | 6/1282 [01:08<3:59:12, 11.25s/it]  1%|          | 7/1282 [01:19<3:58:37, 11.23s/it]  1%|          | 8/1282 [01:31<3:58:17, 11.22s/it]  1%|          | 9/1282 [01:42<3:58:05, 11.22s/it]  1%|          | 10/1282 [01:53<3:57:59, 11.23s/it]                                                     1%|          | 10/1282 [01:53<3:57:59, 11.23s/it]  1%|          | 11/1282 [02:04<3:57:57, 11.23s/it]  1%|          | 12/1282 [02:15<3:57:55, 11.24s/it]  1%|          | 13/1282 [02:27<3:57:57, 11.25s/it]  1%|          | 14/1282 [02:38<3:57:54, 11.26s/it]  1%|          | 15/1282 [02:49<3:57:52, 11.27s/it]  1%|          | 16/1282 [03:01<3:57:49, 11.27s/it]  1%|▏         | 17/1282 [03:12<3:57:46, 11.28s/it]  1%|▏         | 18/1282 [03:23<3:57:42, 11.28s/it]  1%|▏         | 19/1282 [03:34<3:57:37, 11.29s/it]  2%|▏         | 20/1282 [03:46<3:57:30, 11.29s/it]                                                     2%|▏         | 20/1282 [03:46<3:57:30, 11.29s/it]  2%|▏         | 21/1282 [03:57<3:57:25, 11.30s/it]  2%|▏         | 22/1282 [04:08<3:57:18, 11.30s/it]  2%|▏         | 23/1282 [04:20<3:57:09, 11.30s/it]  2%|▏         | 24/1282 [04:31<3:57:00, 11.30s/it]  2%|▏         | 25/1282 [04:42<3:56:53, 11.31s/it]  2%|▏         | 26/1282 [04:54<3:56:45, 11.31s/it]  2%|▏         | 27/1282 [05:05<3:56:35, 11.31s/it]  2%|▏         | 28/1282 [05:16<3:56:23, 11.31s/it]  2%|▏         | 29/1282 [05:28<3:56:11, 11.31s/it]  2%|▏         | 30/1282 [05:39<3:56:02, 11.31s/it]                                                     2%|▏         | 30/1282 [05:39<3:56:02, 11.31s/it]  2%|▏         | 31/1282 [05:50<3:55:52, 11.31s/it]  2%|▏         | 32/1282 [06:02<3:55:41, 11.31s/it]  3%|▎         | 33/1282 [06:13<3:55:29, 11.31s/it]  3%|▎         | 34/1282 [06:24<3:55:15, 11.31s/it]  3%|▎         | 35/1282 [06:35<3:55:05, 11.31s/it]  3%|▎         | 36/1282 [06:47<3:54:54, 11.31s/it]  3%|▎         | 37/1282 [06:58<3:54:42, 11.31s/it]  3%|▎         | 38/1282 [07:09<3:54:32, 11.31s/it]  3%|▎         | 39/1282 [07:21<3:54:21, 11.31s/it]  3%|▎         | 40/1282 [07:32<3:54:09, 11.31s/it]                                                     3%|▎         | 40/1282 [07:32<3:54:09, 11.31s/it]  3%|▎         | 41/1282 [07:43<3:53:58, 11.31s/it]  3%|▎         | 42/1282 [07:55<3:53:47, 11.31s/it]  3%|▎         | 43/1282 [08:06<3:53:37, 11.31s/it]  3%|▎         | 44/1282 [08:17<3:53:24, 11.31s/it]  4%|▎         | 45/1282 [08:29<3:53:12, 11.31s/it]  4%|▎         | 46/1282 [08:40<3:53:01, 11.31s/it]  4%|▎         | 47/1282 [08:51<3:52:50, 11.31s/it]  4%|▎         | 48/1282 [09:03<3:52:40, 11.31s/it]  4%|▍         | 49/1282 [09:14<3:52:29, 11.31s/it]  4%|▍         | 50/1282 [09:25<3:52:17, 11.31s/it]                                                     4%|▍         | 50/1282 [09:25<3:52:17, 11.31s/it]  4%|▍         | 51/1282 [09:36<3:52:07, 11.31s/it]  4%|▍         | 52/1282 [09:48<3:51:54, 11.31s/it]  4%|▍         | 53/1282 [09:59<3:51:42, 11.31s/it]  4%|▍         | 54/1282 [10:10<3:51:31, 11.31s/it]  4%|▍         | 55/1282 [10:22<3:51:18, 11.31s/it]  4%|▍         | 56/1282 [10:33<3:51:06, 11.31s/it]  4%|▍         | 57/1282 [10:44<3:50:54, 11.31s/it]  5%|▍         | 58/1282 [10:56<3:50:44, 11.31s/it]  5%|▍         | 59/1282 [11:07<3:50:35, 11.31s/it]  5%|▍         | 60/1282 [11:18<3:50:22, 11.31s/it]                                                     5%|▍         | 60/1282 [11:18<3:50:22, 11.31s/it]  5%|▍         | 61/1282 [11:30<3:50:11, 11.31s/it]  5%|▍         | 62/1282 [11:41<3:49:59, 11.31s/it]  5%|▍         | 63/1282 [11:52<3:49:47, 11.31s/it]  5%|▍         | 64/1282 [12:03<3:49:35, 11.31s/it]  5%|▌         | 65/1282 [12:15<3:49:23, 11.31s/it]  5%|▌         | 66/1282 [12:26<3:49:10, 11.31s/it]  5%|▌         | 67/1282 [12:37<3:49:00, 11.31s/it]  5%|▌         | 68/1282 [12:49<3:48:51, 11.31s/it]  5%|▌         | 69/1282 [13:00<3:48:40, 11.31s/it]  5%|▌         | 70/1282 [13:11<3:48:29, 11.31s/it]                                                     5%|▌         | 70/1282 [13:11<3:48:29, 11.31s/it]  6%|▌         | 71/1282 [13:23<3:48:17, 11.31s/it]  6%|▌         | 72/1282 [13:34<3:48:07, 11.31s/it]  6%|▌         | 73/1282 [13:45<3:47:54, 11.31s/it]  6%|▌         | 74/1282 [13:57<3:47:41, 11.31s/it]  6%|▌         | 75/1282 [14:08<3:47:29, 11.31s/it]  6%|▌         | 76/1282 [14:19<3:47:17, 11.31s/it]  6%|▌         | 77/1282 [14:31<3:47:06, 11.31s/it]  6%|▌         | 78/1282 [14:42<3:46:55, 11.31s/it]  6%|▌         | 79/1282 [14:53<3:46:43, 11.31s/it]  6%|▌         | 80/1282 [15:04<3:46:31, 11.31s/it]                                                     6%|▌         | 80/1282 [15:04<3:46:31, 11.31s/it]  6%|▋         | 81/1282 [15:16<3:46:20, 11.31s/it]  6%|▋         | 82/1282 [15:27<3:46:10, 11.31s/it]  6%|▋         | 83/1282 [15:38<3:45:57, 11.31s/it]  7%|▋         | 84/1282 [15:50<3:45:46, 11.31s/it]  7%|▋         | 85/1282 [16:01<3:45:36, 11.31s/it]  7%|▋         | 86/1282 [16:12<3:45:37, 11.32s/it]  7%|▋         | 87/1282 [16:22<3:35:27, 10.82s/it]  7%|▋         | 88/1282 [16:33<3:38:07, 10.96s/it]  7%|▋         | 89/1282 [16:45<3:39:56, 11.06s/it]  7%|▋         | 90/1282 [16:56<3:41:12, 11.13s/it]                                                     7%|▋         | 90/1282 [16:56<3:41:12, 11.13s/it]  7%|▋         | 91/1282 [17:07<3:42:03, 11.19s/it]  7%|▋         | 92/1282 [17:18<3:42:33, 11.22s/it]  7%|▋         | 93/1282 [17:30<3:42:52, 11.25s/it]  7%|▋         | 94/1282 [17:41<3:43:05, 11.27s/it]  7%|▋         | 95/1282 [17:52<3:43:08, 11.28s/it]  7%|▋         | 96/1282 [18:04<3:43:09, 11.29s/it]  8%|▊         | 97/1282 [18:15<3:43:07, 11.30s/it]  8%|▊         | 98/1282 [18:26<3:43:01, 11.30s/it]  8%|▊         | 99/1282 [18:38<3:42:53, 11.30s/it]  8%|▊         | 100/1282 [18:49<3:42:45, 11.31s/it]                                                      8%|▊         | 100/1282 [18:49<3:42:45, 11.31s/it]  8%|▊         | 101/1282 [19:00<3:42:38, 11.31s/it]  8%|▊         | 102/1282 [19:12<3:42:29, 11.31s/it]  8%|▊         | 103/1282 [19:23<3:42:20, 11.32s/it]  8%|▊         | 104/1282 [19:34<3:42:09, 11.32s/it]  8%|▊         | 105/1282 [19:46<3:41:57, 11.32s/it]  8%|▊         | 106/1282 [19:57<3:41:45, 11.31s/it]  8%|▊         | 107/1282 [20:08<3:41:33, 11.31s/it]  8%|▊         | 108/1282 [20:20<3:41:23, 11.32s/it]  9%|▊         | 109/1282 [20:31<3:41:12, 11.32s/it]  9%|▊         | 110/1282 [20:42<3:40:59, 11.31s/it]                                                      9%|▊         | 110/1282 [20:42<3:40:59, 11.31s/it]  9%|▊         | 111/1282 [20:53<3:40:47, 11.31s/it]  9%|▊         | 112/1282 [21:05<3:40:34, 11.31s/it]  9%|▉         | 113/1282 [21:16<3:40:22, 11.31s/it]  9%|▉         | 114/1282 [21:27<3:40:12, 11.31s/it]  9%|▉         | 115/1282 [21:39<3:40:02, 11.31s/it]  9%|▉         | 116/1282 [21:50<3:39:51, 11.31s/it]  9%|▉         | 117/1282 [22:01<3:39:40, 11.31s/it]  9%|▉         | 118/1282 [22:13<3:39:28, 11.31s/it]  9%|▉         | 119/1282 [22:24<3:39:16, 11.31s/it]  9%|▉         | 120/1282 [22:35<3:39:03, 11.31s/it]                                                      9%|▉         | 120/1282 [22:35<3:39:03, 11.31s/it]  9%|▉         | 121/1282 [22:47<3:38:50, 11.31s/it] 10%|▉         | 122/1282 [22:58<3:38:38, 11.31s/it] 10%|▉         | 123/1282 [23:09<3:38:25, 11.31s/it] 10%|▉         | 124/1282 [23:20<3:38:13, 11.31s/it] 10%|▉         | 125/1282 [23:32<3:38:01, 11.31s/it] 10%|▉         | 126/1282 [23:43<3:37:50, 11.31s/it] 10%|▉         | 127/1282 [23:54<3:37:39, 11.31s/it] 10%|▉         | 128/1282 [24:06<3:37:28, 11.31s/it] 10%|█         | 129/1282 [24:17<3:37:18, 11.31s/it] 10%|█         | 130/1282 [24:28<3:37:07, 11.31s/it]                                                     10%|█         | 130/1282 [24:28<3:37:07, 11.31s/it] 10%|█         | 131/1282 [24:40<3:36:55, 11.31s/it] 10%|█         | 132/1282 [24:51<3:36:42, 11.31s/it] 10%|█         | 133/1282 [25:02<3:36:31, 11.31s/it] 10%|█         | 134/1282 [25:14<3:36:19, 11.31s/it] 11%|█         | 135/1282 [25:25<3:36:10, 11.31s/it] 11%|█         | 136/1282 [25:36<3:35:59, 11.31s/it] 11%|█         | 137/1282 [25:47<3:35:47, 11.31s/it] 11%|█         | 138/1282 [25:59<3:35:36, 11.31s/it] 11%|█         | 139/1282 [26:10<3:35:25, 11.31s/it] 11%|█         | 140/1282 [26:21<3:35:13, 11.31s/it]                                                     11%|█         | 140/1282 [26:21<3:35:13, 11.31s/it] 11%|█         | 141/1282 [26:33<3:35:03, 11.31s/it] 11%|█         | 142/1282 [26:44<3:34:50, 11.31s/it] 11%|█         | 143/1282 [26:55<3:34:40, 11.31s/it] 11%|█         | 144/1282 [27:07<3:34:30, 11.31s/it] 11%|█▏        | 145/1282 [27:18<3:34:19, 11.31s/it] 11%|█▏        | 146/1282 [27:29<3:34:09, 11.31s/it] 11%|█▏        | 147/1282 [27:41<3:33:55, 11.31s/it] 12%|█▏        | 148/1282 [27:52<3:33:43, 11.31s/it] 12%|█▏        | 149/1282 [28:03<3:33:32, 11.31s/it] 12%|█▏        | 150/1282 [28:14<3:33:19, 11.31s/it]                                                     12%|█▏        | 150/1282 [28:14<3:33:19, 11.31s/it] 12%|█▏        | 151/1282 [28:26<3:33:08, 11.31s/it] 12%|█▏        | 152/1282 [28:37<3:32:56, 11.31s/it] 12%|█▏        | 153/1282 [28:48<3:32:45, 11.31s/it] 12%|█▏        | 154/1282 [29:00<3:32:33, 11.31s/it] 12%|█▏        | 155/1282 [29:11<3:32:21, 11.31s/it] 12%|█▏        | 156/1282 [29:22<3:32:10, 11.31s/it] 12%|█▏        | 157/1282 [29:34<3:31:58, 11.31s/it] 12%|█▏        | 158/1282 [29:45<3:31:46, 11.31s/it] 12%|█▏        | 159/1282 [29:56<3:32:55, 11.38s/it] 12%|█▏        | 160/1282 [30:08<3:32:20, 11.36s/it]                                                     12%|█▏        | 160/1282 [30:08<3:32:20, 11.36s/it] 13%|█▎        | 161/1282 [30:19<3:31:55, 11.34s/it] 13%|█▎        | 162/1282 [30:30<3:31:33, 11.33s/it] 13%|█▎        | 163/1282 [30:42<3:31:14, 11.33s/it] 13%|█▎        | 164/1282 [30:53<3:30:57, 11.32s/it] 13%|█▎        | 165/1282 [31:04<3:30:42, 11.32s/it] 13%|█▎        | 166/1282 [31:16<3:30:28, 11.32s/it] 13%|█▎        | 167/1282 [31:27<3:30:15, 11.31s/it] 13%|█▎        | 168/1282 [31:38<3:30:02, 11.31s/it] 13%|█▎        | 169/1282 [31:50<3:29:51, 11.31s/it] 13%|█▎        | 170/1282 [32:01<3:29:41, 11.31s/it]                                                     13%|█▎        | 170/1282 [32:01<3:29:41, 11.31s/it] 13%|█▎        | 171/1282 [32:12<3:29:30, 11.31s/it] 13%|█▎        | 172/1282 [32:24<3:29:17, 11.31s/it] 13%|█▎        | 173/1282 [32:31<3:07:14, 10.13s/it]                                                     13%|█▎        | 173/1282 [32:32<3:07:14, 10.13s/it] 13%|█▎        | 173/1282 [32:32<3:28:36, 11.29s/it]
wandb: Waiting for W&B process to finish... (success).
wandb: 
wandb: Run history:
wandb:                    train/epoch ▁▁▁▁▁▁▂▂▇▇▇▇██████
wandb:              train/global_step ▁▁▂▂▃▃▄▄▄▅▅▆▆▇▇▇██
wandb:            train/learning_rate ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁
wandb:                     train/loss ████▇▇▇█▅▁▁▁▂▂▂▂▂
wandb:               train/total_flos ▁
wandb:               train/train_loss ▁
wandb:            train/train_runtime ▁
wandb: train/train_samples_per_second ▁
wandb:   train/train_steps_per_second ▁
wandb: 
wandb: Run summary:
wandb:                    train/epoch 1.13
wandb:              train/global_step 173
wandb:            train/learning_rate 0.0003
wandb:                     train/loss 0.5752
wandb:               train/total_flos 1.1257746031981363e+17
wandb:               train/train_loss 0.70644
wandb:            train/train_runtime 1955.3204
wandb: train/train_samples_per_second 5.246
wandb:   train/train_steps_per_second 0.656
wandb: 
wandb: 🚀 View run molora/expert_5 at: https://wandb.ai/alexrs95/herd-llama/runs/fddzmdwm
wandb: ️⚡ View job at https://wandb.ai/alexrs95/herd-llama/jobs/QXJ0aWZhY3RDb2xsZWN0aW9uOjk5NjEyNzE2/version_details/v13
wandb: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)
wandb: Find logs at: ./wandb/run-20231028_172500-fddzmdwm/logs
